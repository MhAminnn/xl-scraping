<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cek Kuota XL & AXIS - Sidompul</title>
    <!-- Tailwind CSS (versi terbaru) -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Toastr CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f2f5;
            background-image: 
                radial-gradient(at 10% 20%, rgba(74, 82, 210, 0.1) 0px, transparent 50%),
                radial-gradient(at 80% 10%, rgba(59, 130, 246, 0.1) 0px, transparent 50%);
        }

        .gradient-button {
            background: linear-gradient(to right, #4f46e5, #3b82f6);
            transition: all 0.3s ease;
        }

        .gradient-button:hover {
            background: linear-gradient(to right, #4338ca, #2563eb);
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .spin-animation {
            animation: spin 1.5s linear infinite;
        }

        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .shimmer {
            background: linear-gradient(90deg, #f3f4f6 0%, #e5e7eb 50%, #f3f4f6 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        #toast-container > .toast-success { background-color: #10B981; }
        #toast-container > .toast-error { background-color: #EF4444; }
        #toast-container > .toast-info { background-color: #3B82F6; }
        #toast-container > .toast-warning { background-color: #F59E0B; }

        .input-highlight {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .input-highlight:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .quota-summary {
            background: linear-gradient(135deg, #6366f1 0%, #3b82f6 100%);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center py-8 px-4">
    <!-- Loading Overlay -->
    <div id="loading" class="fixed inset-0 bg-white bg-opacity-80 z-50 flex flex-col items-center justify-center hidden">
        <div class="relative">
            <div class="w-20 h-20 border-4 border-blue-100 rounded-full"></div>
            <div class="absolute top-0 left-0 w-20 h-20 border-4 border-t-blue-500 border-r-blue-500 border-b-transparent border-l-transparent rounded-full spin-animation"></div>
        </div>
        <div class="mt-4 text-blue-600 font-medium flex items-center">
            <span class="pulse-animation mr-2">●</span>
            Memproses Permintaan
            <span class="pulse-animation ml-2">●</span>
        </div>
    </div>

    <div class="w-full max-w-md card-hover bg-white rounded-2xl shadow-xl overflow-hidden">
        <!-- Header -->
        <div class="relative bg-gradient-to-r from-indigo-600 to-blue-500 text-white pt-8 pb-14 px-6">
            <div class="flex items-center justify-center space-x-3 mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                    <path d="M12 18h.01"></path>
                    <path d="M8 6h8"></path>
                    <path d="M17 14c.5-2 0-6-5-6s-5.5 4-5 6"></path>
                </svg>
                <h1 class="text-2xl font-bold tracking-tight">CEK KUOTA XL & AXIS</h1>
            </div>
            <p class="text-blue-100 text-center opacity-90 font-medium">Versi 3.0.0</p>
            <div class="absolute bottom-0 left-0 right-0 overflow-hidden">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 120" class="w-full h-12">
                    <path fill="#ffffff" fill-opacity="1" d="M0,64L80,69.3C160,75,320,85,480,80C640,75,800,53,960,42.7C1120,32,1280,32,1360,32L1440,32L1440,120L1360,120C1280,120,1120,120,960,120C800,120,640,120,480,120C320,120,160,120,80,120L0,120Z"></path>
                </svg>
            </div>
        </div>

        <!-- Content -->
        <div class="px-6 py-6 -mt-2">
            <!-- Info Box -->
            <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4 mb-6">
                <div class="flex">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500 mr-3 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="17" x2="12" y2="17"></line>
                    </svg>
                    <div>
                        <p class="font-semibold text-blue-800">INFORMASI</p>
                        <p class="text-blue-600 text-sm mt-1">Masukkan nomor XL/AXIS untuk cek sisa kuota yang masih bisa digunakan. Hindari spam!</p>
                    </div>
                </div>
            </div>

            <!-- Form -->
            <div class="space-y-4">
                <div>
                    <label for="nomorHp" class="block text-sm font-medium text-gray-700 mb-1">Nomor XL/AXIS:</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M15.05 5A5 5 0 0 1 19 8.95M15.05 1A9 9 0 0 1 23 8.94m-1 7.98v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                            </svg>
                        </div>
                        <input type="tel" id="nomorHp" class="input-highlight w-full pl-10 pr-4 py-3 rounded-xl border border-gray-300 focus:outline-none" placeholder="Contoh: 08123456789 atau 628123456789" maxlength="13">
                    </div>
                    <p class="mt-1 text-xs text-gray-500 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12" y2="8"></line>
                        </svg>
                        Gunakan format 08xx atau 628xx
                    </p>
                </div>
                <button id="btnCek" class="gradient-button w-full py-3 px-4 rounded-xl text-white font-semibold flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 17.25a6.25 6.25 0 1 1 0-12.5 6.25 6.25 0 0 1 0 12.5z"></path>
                        <path d="M15.25 15.25L21 21"></path>
                    </svg>
                    CEK KUOTA
                </button>
            </div>

            <!-- Result Area -->
            <div id="hasilKuota" class="mt-6 fade-in hidden"></div>
        </div>
    </div>

    <!-- jQuery (versi terbaru) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Toastr JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script>
        $(document).ready(function() {
            // Konfigurasi Toastr
            toastr.options = {
                closeButton: true,
                progressBar: true,
                positionClass: "toast-top-right",
                timeOut: "5000",
                showDuration: "300",
                hideDuration: "500",
                extendedTimeOut: "1000",
                showEasing: "swing",
                hideEasing: "linear",
                showMethod: "fadeIn",
                hideMethod: "fadeOut"
            };

            // Efek hover tombol
            $("#btnCek").hover(
                function() { $(this).find("svg").addClass("animate-bounce"); },
                function() { $(this).find("svg").removeClass("animate-bounce"); }
            );

            // Event handler untuk tombol dan input
            $("#btnCek").click(cekKuota);
            $("#nomorHp").keypress(function(e) { if (e.which === 13) cekKuota(); });

            // Fungsi loading
            function showLoading() { $("#loading").removeClass("hidden").addClass("flex"); }
            function hideLoading() { $("#loading").removeClass("flex").addClass("hidden"); }

            // Fungsi untuk menghitung sisa kuota yang masih bisa digunakan dari data JSON
            function calculateRemainingQuota(data) {
                let remainingQuotaBytes = 0;

                // Ambil data kuota dari response.data.data_sp.quotas.value
                const quotas = data.data_sp?.quotas?.value || [];
                quotas.forEach(quota => {
                    const details = quota.detail_quota || [];
                    details.forEach(detail => {
                        const remaining = parseInt(detail.remaining, 10) || 0;
                        remainingQuotaBytes += remaining;
                    });
                });

                // Konversi byte ke GB
                const remainingQuotaGB = remainingQuotaBytes / (1024 * 1024 * 1024); // Byte ke GB
                return remainingQuotaGB.toFixed(2); // Bulatkan ke 2 desimal
            }

            // Fungsi utama untuk cek kuota
            function cekKuota() {
                const nomor = $("#nomorHp").val().trim();

                // Validasi input
                if (!nomor) {
                    toastr.error("Harap masukkan nomor XL/AXIS Anda!");
                    $("#nomorHp").focus();
                    return;
                }

                if (!/^(08|628)\d{8,11}$/.test(nomor)) {
                    toastr.error("Format nomor tidak valid! Gunakan 08xx atau 628xx (10-13 digit).");
                    $("#nomorHp").focus();
                    return;
                }

                showLoading();
                $("#hasilKuota").html(`
                    <div class="shimmer rounded-xl h-20 w-full mb-3"></div>
                    <div class="shimmer rounded-xl h-8 w-1/2 mb-3"></div>
                    <div class="shimmer rounded-xl h-4 w-full mb-2"></div>
                    <div class="shimmer rounded-xl h-4 w-2/3 mb-2"></div>
                    <div class="shimmer rounded-xl h-4 w-3/4 mb-2"></div>
                `).removeClass("hidden");

                $.ajax({
                    type: "GET",
                    url: "https://apigw.kmsp-store.com/sidompul/v3/cek_kuota",
                    data: { msisdn: nomor, isJSON: true },
                    headers: {
                        "Authorization": "Basic c2lkb21wdWxhcGk6YXBpZ3drbXNw",
                        "X-API-Key": "4352ff7d-f4e6-48c6-89dd-21c811621b1c",
                        "X-App-Version": "3.0.0"
                    },
                    success: function(response) {
                        hideLoading();
                        if (response.status === true) {
                            toastr.success("Berhasil mendapatkan data kuota!");
                            const remainingQuotaGB = calculateRemainingQuota(response.data);

                            $("#hasilKuota").html(`
                                <div class="quota-summary rounded-xl p-4 mb-4 text-white">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 icon-pulse" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M21 10v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V10"></path>
                                                <path d="M22 6H2v4h20V6z"></path>
                                                <path d="M12 2v14"></path>
                                                <path d="M10 6H4.5a2.5 2.5 0 0 1 0-5C7 1 10 6 10 6z"></path>
                                                <path d="M14 6h5.5a2.5 2.5 0 0 0 0-5C17 1 14 6 14 6z"></path>
                                            </svg>
                                            <h3 class="text-lg font-semibold">Sisa Kuota yang Masih Bisa Digunakan</h3>
                                        </div>
                                        <div class="bg-white bg-opacity-20 rounded-lg px-2 py-1 text-sm">${remainingQuotaGB} GB</div>
                                    </div>
                                </div>
                                <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-xl p-5 border border-green-100">
                                    <div class="flex items-center mb-3">
                                        <div class="bg-green-100 p-2 rounded-full mr-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M6 10.6V5.8a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.4a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2V10.6z"></path>
                                                <path d="M11.5 18.7a.8.8 0 0 0 1.5 0l.9-1.8a.8.8 0 0 0 0-.8l-1.5-2.8a.8.8 0 0 0-1.5 0L9.5 16a.8.8 0 0 0 0 .8l1.1 1.9z"></path>
                                            </svg>
                                        </div>
                                        <h3 class="text-lg font-semibold text-gray-800">Detail Kuota</h3>
                                    </div>
                                    <div class="border-t border-gray-200 pt-3">${response.data.hasil}</div>
                                </div>
                            `).removeClass("hidden");
                        } else {
                            toastr.error(response.message || "Gagal mendapatkan data kuota.");
                            $("#hasilKuota").html(`
                                <div class="bg-gradient-to-br from-red-50 to-pink-50 rounded-xl p-5 border border-red-100">
                                    <div class="flex items-center mb-3">
                                        <div class="bg-red-100 p-2 rounded-full mr-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                            </svg>
                                        </div>
                                        <h3 class="text-lg font-semibold text-gray-800">Gagal</h3>
                                    </div>
                                    <div class="border-t border-gray-200 pt-3 text-red-600">${response.data?.keteranganError || "Tidak ada keterangan error."}</div>
                                </div>
                            `).removeClass("hidden");
                        }
                    },
                    error: function(xhr, status, error) {
                        hideLoading();
                        toastr.error("Kesalahan jaringan. Silakan coba lagi.");
                        $("#hasilKuota").html(`
                            <div class="bg-gradient-to-br from-red-50 to-pink-50 rounded-xl p-5 border border-red-100">
                                <div class="flex items-center mb-3">
                                    <div class="bg-red-100 p-2 rounded-full mr-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <line x1="1" y1="1" x2="23" y2="23"></line>
                                            <path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"></path>
                                            <path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"></path>
                                            <path d="M10.71 5.05A16 16 0 0 1 22.58 9"></path>
                                            <path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"></path>
                                            <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                                            <line x1="12" y1="20" x2="12.01" y2="20"></line>
                                        </svg>
                                    </div>
                                    <h3 class="text-lg font-semibold text-gray-800">Error</h3>
                                </div>
                                <div class="border-t border-gray-200 pt-3 text-red-600">Gagal terhubung ke server. Periksa koneksi Anda.</div>
                            </div>
                        `).removeClass("hidden");
                        console.error("AJAX Error:", error);
                    }
                });
            }

            // Animasi input saat fokus
            $("#nomorHp").on("focus", function() {
                $(this).parent().parent().addClass("scale-105").css("transition", "all 0.3s ease");
            }).on("blur", function() {
                $(this).parent().parent().removeClass("scale-105");
            });
        });
    </script>
</body>
</html>
